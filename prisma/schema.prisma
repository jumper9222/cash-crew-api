generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model transactions {
  id               String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title            String             @db.VarChar(255)
  description      String?
  date             String             @db.Char(10)
  total_amount     Decimal            @db.Decimal(12, 2)
  currency         String             @db.VarChar(3)
  date_created     DateTime           @default(now()) @db.Timestamptz(6)
  date_modified    DateTime           @default(now()) @updatedAt @db.Timestamptz(6)
  user_id          String             @db.VarChar(255)
  category         String             @db.VarChar(255)
  is_split         Boolean?
  photo_url        String?            @db.VarChar
  paid_by          String?            @db.VarChar(255)
  group_id         String?            @db.Uuid
  transaction_type transaction_types?
  splits           splits[]
  groups           groups?            @relation(fields: [group_id], references: [id], onDelete: NoAction, map: "group_id_fk")

  @@index([category], map: "idx_category")
  @@index([date], map: "idx_date")
  @@index([user_id, date], map: "idx_user_date")
  @@index([user_id], map: "idx_user_id")
}

model splits {
  id                   String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id              String                 @db.VarChar(255)
  transaction_id       String                 @db.Uuid
  split_amount         Decimal                @db.Decimal(12, 2)
  category             String                 @db.VarChar(255)
  group_id             String?                @db.Uuid
  settled_amount       Decimal                @default(0) @db.Decimal(12, 2)
  groups               groups?                @relation(fields: [group_id], references: [id], onDelete: NoAction, map: "fk_group")
  transaction          transactions           @relation(fields: [transaction_id], references: [id], onDelete: Cascade, map: "fk_transaction")
  transfer_allocations transfer_allocations[]

  @@unique([transaction_id, user_id], map: "transaction_id_user_id")
}

model transaction_templates {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name          String    @db.VarChar(100)
  user_id       String    @db.VarChar(255)
  title         String    @db.VarChar(255)
  description   String
  date          DateTime  @db.Date
  total_amount  Decimal   @db.Decimal(12, 2)
  currency      String    @db.VarChar(3)
  date_created  DateTime? @default(now()) @db.Timestamp(6)
  date_modified DateTime? @db.Timestamp(6)
  category      String    @db.VarChar(255)
  is_split      Boolean?
  icon          String?   @db.Char(1)
}

model group_members {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id   String   @db.VarChar(255)
  group_id  String   @db.Uuid
  role      String   @db.VarChar(100)
  joined_at DateTime @default(now()) @db.Timestamp(6)
  groups    groups   @relation(fields: [group_id], references: [id], onDelete: NoAction, map: "group_id_fk")

  @@unique([group_id, user_id], map: "unique_group_user")
}

model groups {
  id            String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name          String          @default("Untitled Group") @db.VarChar(255)
  created_by    String          @db.VarChar(255)
  date_created  DateTime        @default(now()) @db.Timestamp(6)
  date_modified DateTime        @default(now()) @db.Timestamp(6)
  group_type    String          @db.VarChar(100)
  icon          String?         @default("ðŸ‘¥") @db.Char(1)
  group_members group_members[]
  splits        splits[]
  transactions  transactions[]
}

model transfer_allocations {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  transfer_id String    @db.Uuid
  split_id    String    @db.Uuid
  amount      Decimal   @db.Decimal(12, 2)
  splits      splits    @relation(fields: [split_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_split")
  transfers   transfers @relation(fields: [transfer_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_transfer")
}

model transfers {
  id                   String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  amount               Decimal                @db.Decimal(12, 2)
  from                 String?
  to                   String?
  created_by           String?
  created_at           DateTime?              @default(now()) @db.Timestamp(6)
  modified_at          DateTime?              @default(now()) @db.Timestamp(6)
  modified_by          String?
  date                 DateTime?              @db.Timestamp(6)
  transfer_allocations transfer_allocations[]
}

enum transaction_types {
  expense
  income
}
